<!DOCTYPE html>
<html>

<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- Content Security Policy - Relaxed for development, tighten in production -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; 
                 script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; 
                 style-src 'self' 'unsafe-inline' https:; 
                 font-src 'self' https: data: blob:; 
                 img-src 'self' data: https: blob:; 
                 connect-src 'self' https: wss: ws://localhost:* ws://127.0.0.1:*; 
                 worker-src 'self' blob:; 
                 frame-ancestors 'none'; 
                 base-uri 'self'; 
                 form-action 'self';">

  <!-- Security Headers -->
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="lab_sense_app">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>lab_sense_app</title>
  <link rel="manifest" href="manifest.json">
</head>

<style>
  .loading-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #f8fafc;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease-out;
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e2e8f0;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  .fade-out {
    opacity: 0;
    pointer-events: none;
  }
</style>

<div id="app-loading" class="loading-container">
  <div class="loading-spinner"></div>
</div>

<script>
  window.onload = function () {
    // Check for Flutter engine periodically
    var checkInterval = setInterval(function () {
      // 'flt-glass-pane' is commonly used by Flutter Web.
      // We also check if the body has significantly more children (Flutter adding itself)
      if (document.querySelector('flt-glass-pane') || document.body.children.length > 3) {
        removeLoader();
      }
    }, 100);

    // Failsafe: Remove loader after 4 seconds (Flutter startup usually < 2s)
    // This ensures the user isn't stuck forever if the detection logic misses.
    setTimeout(removeLoader, 4000);

    function removeLoader() {
      clearInterval(checkInterval);
      var loader = document.getElementById('app-loading');
      if (loader) {
        loader.classList.add('fade-out');
        setTimeout(() => {
          loader.style.display = 'none';
        }, 500); // Wait for transition
      }
    }
  };
</script>

<!-- Legacy/Standard Flutter Script Loading -->
<script src="main.dart.js" type="application/javascript"></script>
</body>

</html>